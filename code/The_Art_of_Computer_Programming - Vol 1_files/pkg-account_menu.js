define("modules/clean/react/growth/features/badge",["require","exports","tslib","react","modules/clean/react/growth/features/types","modules/clean/react/growth/logging_util","modules/clean/react/css"],(function(e,t,a,n,o,u,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a.__extends(t,e),t.prototype.componentDidMount=function(){this.props.text&&u.logDisplay(this.props.project,u.ComponentName.AVATAR_MENU,{featureType:(this.props.text+"_badge").toLowerCase()})},t.prototype.render=function(){var e=this.props,t=e.className,a=e.color,o=e.text;return!!o&&n.default.createElement("span",{className:"growth-features-badge badge badge--color-"+a+" "+t},o)},t.defaultProps={className:"",color:o.BadgeColor.WHITE},t})((n=a.__importDefault(n)).default.PureComponent);t.FeaturesBadgeComponent=r,t.FeaturesBadge=c.requireCssWithComponent(r,["/static/css/react/badge-vflZ3Vv1R.css","/static/css/react/growth/features/badge-vflgUaujS.css"])})),define("modules/clean/react/growth/features/util",["require","exports","tslib","modules/core/browser","modules/clean/server_side_client_view_bridge","modules/clean/react/growth/logging_util","modules/clean/react/growth/features/types","modules/clean/react/growth/util","modules/clean/react/growth/feature_tour_modal/feature_tour_modal_loader"],(function(e,t,a,n,o,u,c,r,s){"use strict";function l(e,t,a){var n=r.getActiveUserId();switch(a.onClickType){case c.OnClickType.SHOW_FEATURE_TOUR_MODAL:return function(){a.moduleName&&n&&r.markModuleAsCompleted(n,a.moduleName),u.logCtaClick(e,t,u.CtaType.OPEN_MODAL,{modalType:c.ModalType.FEATURE_TOUR_MODAL}),s.renderFeatureTourModal(e)}}}function i(e,t,a,c,r,s){if(u.logCtaClick(t,a,u.CtaType.OPEN_EXTERNAL_LINK,{href:e}),o.GetPlatform()){var l=s?o.ViewManagementClose:void 0;r?o.OpenCredentialedBrowser(e,r,l):o.OpenUncredentialedBrowser(e,l)}else c?n.open_tab(e):n.redirect(e)}Object.defineProperty(t,"__esModule",{value:!0}),n=a.__importStar(n),o=a.__importStar(o),t.getOnClickHandler=l,t.getOnClickHandlerForCta=function(e,t,a,n){if(a.href||a.onClick||a.onClickType)return a.onClickType?l(e,t,a):a.onClick?a.onClick:function(){return i(a.href||"#",e,t,!1,n,!0)}},t.openHref=i})),define("modules/clean/react/growth/feature_tour_modal/constants",["require","exports","modules/clean/ts_utils","modules/clean/react/growth/features/types"],(function(e,t,a,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),(function(e){e.UPLOAD="upload",e.SHARING="sharing",e.ORGANIZING="organizing",e.HELP="help"})(o=t.TopicKey||(t.TopicKey={})),(function(e){e.LIST="list",e.SINGLE="single"})(t.TopicType||(t.TopicType={})),(function(e){e.IMAGE="image",e.VIDEO="video"})(t.VisualAssetType||(t.VisualAssetType={})),(function(e){e.CLOUD="cloud",e.ORCHID="orchid",e.WHEAT="wheat",e.WHITE="white"})(t.BackgroundColor||(t.BackgroundColor={})),t.getTopicKeys=function(e){switch(e){case n.ProjectType.NCCT_PLUS_TRIALS:case n.ProjectType.NCCT_PLUS_TRIALS_ENABLE_AUTO_CONVERT:case n.ProjectType.PLATFORM_PLUS_TRIALS_30D:case n.ProjectType.POT_OF_GOLD:case n.ProjectType.WEB_FAMILY_DIRECT:case n.ProjectType.WEB_PLUS_DIRECT:case n.ProjectType.WEB_PLUS_TRIALS:return[o.UPLOAD,o.ORGANIZING,o.SHARING,o.HELP];default:return a.enforceExhaustive(e)}}})),define("modules/clean/react/growth/feature_tour_modal/feature_tour_modal_loader",["require","exports","tslib","react","modules/clean/react/async/loadable","modules/clean/react/growth/feature_tour_modal/constants","modules/clean/react/growth/logging_util"],(function(e,t,a,n,o,u,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a.__importDefault(n);var r=o.Loadable({loader:function(){return new Promise((function(t,a){e(["modules/clean/react/growth/feature_tour_modal/components/feature_tour_modal"],t,a)})).then(a.__importStar).then((function(e){return e.FeatureTourModal}))}});t.renderFeatureTourModal=function(t,o,s){var l=u.getTopicKeys(t);return l.length?new Promise((function(t,a){e(["modules/clean/react/modal"],t,a)})).then(a.__importStar).then((function(e){e.Modal.showInstance(n.default.createElement(r,{topicKeys:l,className:o,handleDismiss:s,loggingProject:t,loggingComponentName:c.ComponentName.FEATURE_TOUR_MODAL}))})):null}})),define("modules/clean/react/growth/trials/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),(function(e){e.CANCEL_TRIAL_BIZ_INVITE="cancel_trial_biz_invite_modal",e.CANCEL_TRIAL_EXPECTATIONS="cancel_trial_expectations_modal",e.CANCEL_TRIAL_SURVEY="cancel_trial_survey_modal"})(t.ModalType||(t.ModalType={})),(function(e){e.NCCT_PLUS_TRIALS="ncct_plus_trials",e.NCCT_PLUS_TRIALS_ENABLE_AUTO_CONVERT="ncct_plus_trials_enable_auto_convert",e.PLATFORM_PLUS_TRIALS_30D="platform_plus_trials_30d",e.RIGHTSIZING="rightsizing",e.WEB_PLUS_TRIALS="web_plus_trials"})(t.ProjectType||(t.ProjectType={})),(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.TRANSITIONS_TRIAL=1]="TRANSITIONS_TRIAL",e[e.PLATFORM_TRIAL=2]="PLATFORM_TRIAL"})(t.TrialSource||(t.TrialSource={}))})),define("spectrum/account_menu",["require","exports","tslib","spectrum/account_menu/account_menu_item","spectrum/account_menu/account_menu_separator","spectrum/account_menu/account_menu_title"],(function(e,t,a,n,o,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a.__exportStar(n,t),a.__exportStar(o,t),a.__exportStar(u,t)})),define("spectrum/account_menu/account_menu_item",["require","exports","tslib","classnames","react","react-aria-menubutton"],(function(e,t,a,n,o,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a.__importDefault(n),o=a.__importStar(o),t.AccountMenuItem=function(e){var t=e.className,c=e.disabled,r=e.href,s=(e.ref,a.__rest(e,["className","disabled","href","ref"])),l=r&&!c?"a":"span",i=n.default(t,"mc-account-menu-item",{"mc-account-menu-item-disabled":c});return c?o.createElement(l,a.__assign({className:i,href:"a"===l?r:void 0},s)):o.createElement(u.MenuItem,Object.assign({tag:l,className:i,href:r},s))},t.AccountMenuItem.displayName="AccountMenuItem"})),define("spectrum/account_menu/account_menu_separator",["require","exports","tslib","classnames","react"],(function(e,t,a,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a.__importDefault(n),o=a.__importStar(o),t.AccountMenuSeparator=function(e){var t=e.className,u=a.__rest(e,["className"]);return o.createElement("hr",Object.assign({className:n.default(t,"mc-account-menu-separator")},u))},t.AccountMenuSeparator.displayName="AccountMenuSeparator"})),define("spectrum/account_menu/account_menu_title",["require","exports","tslib","classnames","react"],(function(e,t,a,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a.__importDefault(n),o=a.__importStar(o),t.AccountMenuTitle=function(e){var t=e.className,u=a.__rest(e,["className"]);return o.createElement("div",Object.assign({className:n.default(t,"mc-account-menu-title")},u))},t.AccountMenuTitle.displayName="AccountMenuTitle"})),define("modules/clean/react/account_menu/account_menu_selector",["require","exports","tslib","react","modules/clean/react/account_menu/account_menu","modules/clean/react/account_menu/account_menu_v2"],(function(e,t,a,n,o,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a.__importStar(n),t.AccountMenuSelector=function(e){return"ON_GETMORESPACE"===e.newAccountMenuExperiment||"ON_UPGRADE"===e.newAccountMenuExperiment||"ON_UPGRADE_QUOTAALWAYS"===e.newAccountMenuExperiment?n.createElement(u.AccountMenuV2,{user:e.user,showInstallLink:!e.hideInstallLink,newAccountMenuExperiment:e.newAccountMenuExperiment}):n.createElement(o.AccountMenu,a.__assign({},e))}})),define("modules/clean/react/account_menu/account_menu_v2",["require","exports","tslib","react","dig-components/layer","modules/clean/ajax_as_promised","modules/clean/analytics","modules/clean/api_v2/user_client","modules/clean/event_handler","modules/clean/react/account_menu/account_menu_types","modules/clean/react/account_menu/account_menu_util","modules/clean/react/account_menu/account_menu_view_v2","modules/clean/snapengage","modules/clean/web_timing_logger","modules/core/browser","modules/core/uri"],(function(e,t,a,n,o,u,c,r,s,l,i,d,m,_,p,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a.__importDefault(n),p=a.__importStar(p);var g=(function(t){function g(e){var a=t.call(this,e)||this;return a.handleChatLink=function(){a.widgetId&&(m.DropboxSnapEngage.startSupportChat(a.widgetId),c.TeamsWebActionsLogger.log("chat_discoverability_account_menu_clicked"))},a.handleMenuSelection=function(e){switch(e){case l.AccountMenuSelectionOption.SETTINGS:p.redirect(i.SETTINGS_URL);break;case l.AccountMenuSelectionOption.INSTALL:i.handleInstallClick(),p.open_tab(i.INSTALL_URL);break;case l.AccountMenuSelectionOption.CHAT:a.handleChatLink();break;case l.AccountMenuSelectionOption.LOGOUT:p.redirect(i.getLogoutUrl())}},a.apiV2Client=new r.UserApiV2Client,a.state={accountPhotoUrl:a.props.user.photo_circle_url,showChatLink:!1,accountSpaceUsage:{currentStatus:l.AccountSpaceUsageStatus.NOT_APPLICABLE}},a}return a.__extends(g,t),g.prototype.componentDidMount=function(){return a.__awaiter(this,void 0,void 0,(function(){return a.__generator(this,(function(t){switch(t.label){case 0:return this.attachEventListeners(),[4,_.waitForTTI()];case 1:return t.sent(),this.getQuotaData(),this.getChatVariants(),[4,new Promise((function(t,a){e(["modules/clean/account/timezone_detection"],t,a)})).then(a.__importStar)];case 2:return t.sent().checkTimezone(),[2]}}))}))},g.prototype.componentWillUnmount=function(){this.events.removeAll()},g.prototype.attachEventListeners=function(){var e=this;this.events=new s.EventHandler,this.events.on(document,"db:account_photo:photo_set",(function(t,a){var n=f.URI.parse(a.saved_photo_url).updateQuery({size:"64x64"}).toString();e.setState({accountPhotoUrl:n})})),this.events.on(document,"db:account_photo:photo_deleted",(function(){e.setState({accountPhotoUrl:void 0})}))},g.prototype.getQuotaData=function(){return a.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,u,c;return a.__generator(this,(function(a){switch(a.label){case 0:e=this.props.user,this.setState({accountSpaceUsage:{currentStatus:l.AccountSpaceUsageStatus.LOADING}}),a.label=1;case 1:return a.trys.push([1,3,,4]),t=this.apiV2Client.ns("users").rpc("get_space_usage",void 0,{subjectUserId:e.id}),n=this.apiV2Client.ns("users").rpc("get_plan_info",{account_id:e.account_id},{subjectUserId:e.id}),[4,Promise.all([t,n])];case 2:return o=a.sent(),u=o[0],c=o[1],this.setState({accountSpaceUsage:i.getAccountSpaceUsage(u,c)}),[3,4];case 3:return a.sent(),this.setState({accountSpaceUsage:{currentStatus:l.AccountSpaceUsageStatus.NOT_APPLICABLE}}),[3,4];case 4:return[2]}}))}))},g.prototype.getChatVariants=function(){return a.__awaiter(this,void 0,void 0,(function(){var e,t;return a.__generator(this,(function(a){switch(a.label){case 0:return e=this.props.user,[4,u.SilentBackgroundRequest({url:"/portkey_chat_discoverability_variant",dataType:"json",subject_user:e.id})];case 1:return(t=a.sent())&&(this.widgetId=t.widgetId,this.setState({showChatLink:"V1"===t.variant&&!!this.widgetId})),[2]}}))}))},g.prototype.render=function(){var e=this.state,t=e.accountPhotoUrl,a=e.showChatLink,u=e.accountSpaceUsage,c=this.props,r=c.newAccountMenuExperiment,s=c.showInstallLink,i=c.user;return n.default.createElement(o.LayerContext.Provider,{value:500},n.default.createElement(d.AccountMenuView,{user:i,accountPhotoUrl:t,showChatLink:a,showInstallLink:!!s,onMenuSelection:this.handleMenuSelection,accountSpaceUsage:u,quotaBarMinimumBreakpoint:"ON_UPGRADE_QUOTAALWAYS"===r?l.AccountMenuQuotaBarBreakpoints.ALWAYS:l.AccountMenuQuotaBarBreakpoints.STANDARD,upgradeText:"ON_GETMORESPACE"===r?l.UpgradeText.GET_MORE_SPACE:l.UpgradeText.UPGRADE}))},g.defaultProps={showInstallLink:!0},g})(n.default.Component);t.AccountMenuV2=g})),define("modules/clean/react/account_menu/account_menu_quota_bar",["require","exports","tslib","react","dig-components/buttons","dig-components/icons","dig-components/icons/src/ui-icon/line/warning","dig-components/typography","modules/clean/display_format","modules/clean/react/account_menu/account_menu_types","modules/clean/react/account_menu/account_menu_util","modules/core/i18n"],(function(e,t,a,n,o,u,c,r,s,l,i,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a.__importDefault(n),t.AccountMenuQuotaBar=function(e){var t=e.accountSpaceUsage;if(t.currentStatus===l.AccountSpaceUsageStatus.LOADING)return null;var a=t.used,o=t.allocated;return n.default.createElement(m,{used:a,allocated:o,upgradeText:e.upgradeText,quotaBarMinimumBreakpoint:e.quotaBarMinimumBreakpoint})};var m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.upgradeButtonClick=function(){i.handleUpgradeButtonClick(t.props.upgradeText)},t}return a.__extends(t,e),t.prototype.componentDidMount=function(){i.handleUpgradeButtonView(this.props.upgradeText)},t.prototype.render=function(){var e=this.props,t=e.upgradeText,a=e.used,m=e.allocated,_=e.quotaBarMinimumBreakpoint,p=Math.min(Math.round(a/m*100),100),f=p>=l.AccountMenuQuotaBarBreakpoints.OVERQUOTA,g=i.getUpsellText(t,p),h=n.default.createElement(o.Button,{className:"account-menu-v2__quota-bar-btn",onClick:this.upgradeButtonClick,size:"small",variant:"transparent"},i.getUpgradeButtonText(t));return p<_?n.default.createElement("div",{className:"account-menu-v2__quota-wrapper"},n.default.createElement(r.Text,{size:"xsmall",color:"faint"},d.intl.formatMessage({id:"wkflKt",defaultMessage:"Your account has {allocated} storage"},{allocated:s.format_bytes(m)})),h):n.default.createElement("div",{className:"account-menu-v2__quota-wrapper"},n.default.createElement("div",{className:"account-menu-v2__quota-bar"},n.default.createElement("div",{className:"account-menu-v2__quota-bar-used",style:{width:p+"%"}})),n.default.createElement("div",null,f&&n.default.createElement(u.UIIcon,{src:c.WarningLine,size:"small",className:"account-menu-v2__quota-bar-icon"}),n.default.createElement(r.Text,{size:"xsmall",color:"faint"},d.intl.formatMessage({id:"KNYHMT",defaultMessage:"{count, plural, one{Using {used} of {allocated} storage} other{Using {used} of {allocated} storage}}"},{count:a,used:s.format_bytes(a),allocated:s.format_bytes(m)}))),g&&n.default.createElement(r.Text,{size:"xsmall",color:"faint"},g),h)},t})(n.default.Component)})),define("modules/clean/react/account_menu/account_menu_user_summary",["require","exports","tslib","react","dig-components/avatar","dig-components/buttons","dig-components/typography","modules/clean/em_string","modules/clean/react/account_menu/account_menu_quota_bar","modules/clean/react/account_menu/account_menu_types","modules/clean/react/account_menu/account_menu_util","modules/core/i18n","modules/core/user_i18n","dig-components/tooltips"],(function(e,t,a,n,o,u,c,r,s,l,i,d,m,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a.__importDefault(n),m=a.__importStar(m),t.AccountMenuUserSummary=function(e){var t=e.user,a=e.upgradeText,p=e.quotaBarMinimumBreakpoint,f=e.accountPhotoUrl,g=e.accountSpaceUsage,h=m.getInitials(t.display_name),A=r.Emstring.em_snippet(t.email,18,1);return n.default.createElement("div",{className:"account-menu-v2__user-summary"},n.default.createElement("div",{className:"account-menu-v2__user-summary-info"},n.default.createElement(u.Button,{variant:"transparent",hasNoUnderline:!0,className:"account-menu-v2__avatar-button account-menu-v2__change-photo",onClick:i.handleChangeAvatar,"aria-label":f?d.intl.formatMessage({id:"7VaQw6",defaultMessage:"Change photo"}):d.intl.formatMessage({id:"0UNJMJ",defaultMessage:"Add photo"})},n.default.createElement(o.Avatar,{role:"presentation",src:f,backgroundColor:o.avatarColorForUserIdentifier(h),className:"account-menu-v2__avatar",hasNoOutline:!0},h)),n.default.createElement("div",{className:"account-menu-v2__user-name"},n.default.createElement(c.Text,null,t.display_name),t.email===A?n.default.createElement(c.Text,{size:"xsmall",color:"faint"},A):n.default.createElement(_.Tooltip,{className:"account-menu-v2__tooltip",id:"user-email",title:t.email},n.default.createElement(c.Text,{size:"xsmall",color:"faint"},A)))),g.currentStatus!==l.AccountSpaceUsageStatus.NOT_APPLICABLE&&n.default.createElement(s.AccountMenuQuotaBar,{upgradeText:a,accountSpaceUsage:g,quotaBarMinimumBreakpoint:p}))}})),define("modules/clean/react/account_menu/account_menu_view_v2",["require","exports","tslib","react","dig-components/avatar","dig-components/buttons","dig-components/menu","modules/clean/react/account_menu/account_menu_types","modules/clean/react/account_menu/account_menu_user_summary","modules/clean/react/account_menu/account_menu_util","modules/clean/react/css","modules/core/i18n","modules/core/user_i18n"],(function(e,t,a,n,o,u,c,r,s,l,i,d,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a.__importDefault(n),m=a.__importStar(m);var _=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.user,i=e.upgradeText,_=e.quotaBarMinimumBreakpoint,p=e.accountPhotoUrl,f=e.accountSpaceUsage,g=e.showChatLink,h=e.showInstallLink,A=e.onMenuSelection,v=m.getInitials(t.display_name);return n.default.createElement(c.Menu.Wrapper,{onToggle:l.handleMenuToggle,onSelection:A},(function(e){var l=e.getTriggerProps,m=e.getContentProps;return n.default.createElement(n.default.Fragment,null,n.default.createElement(u.Button,a.__assign({},l(),{variant:"transparent",hasNoUnderline:!0,className:"account-menu-v2__avatar-button account-menu-v2__trigger","aria-label":d.intl.formatMessage({id:"YPWjDD",defaultMessage:"Account menu"})}),n.default.createElement(o.Avatar,{alt:d.intl.formatMessage({id:"YPWjDD",defaultMessage:"Account menu"}),src:p,backgroundColor:o.avatarColorForUserIdentifier(v),className:"account-menu-v2__avatar account-menu-v2__avatar-header",size:"standard",hasNoOutline:!0},v)),n.default.createElement(c.Menu.Content,a.__assign({className:"account-menu-v2__content"},m(),{placement:"bottom-end"}),n.default.createElement(c.Menu.Segment,null,n.default.createElement(s.AccountMenuUserSummary,{user:t,accountPhotoUrl:p,accountSpaceUsage:f,upgradeText:i,quotaBarMinimumBreakpoint:_})),n.default.createElement(c.Menu.Segment,null,n.default.createElement(c.Menu.ActionItem,{key:r.AccountMenuSelectionOption.SETTINGS,value:r.AccountMenuSelectionOption.SETTINGS},d.intl.formatMessage({id:"x/c7tU",defaultMessage:"Settings"})),h&&n.default.createElement(c.Menu.ActionItem,{key:r.AccountMenuSelectionOption.INSTALL,value:r.AccountMenuSelectionOption.INSTALL},d.intl.formatMessage({id:"ruR+3P",defaultMessage:"Install Dropbox app"})),g&&n.default.createElement(c.Menu.ActionItem,{key:r.AccountMenuSelectionOption.CHAT,value:r.AccountMenuSelectionOption.CHAT},d.intl.formatMessage({id:"TBIxin",defaultMessage:"Chat with support"})),n.default.createElement(c.Menu.ActionItem,{key:r.AccountMenuSelectionOption.LOGOUT,value:r.AccountMenuSelectionOption.LOGOUT},d.intl.formatMessage({id:"3BZJoW",defaultMessage:"Sign out"})))))}))},t})(n.default.PureComponent),p=i.requireCssWithComponent(_,["/static/css/account_menu_v2-vfl44mLvJ.css","/static/css/dig-components/index.web-vflVqzbR_.css"]);t.AccountMenuView=p})),define("modules/clean/react/account_menu/account_menu",["require","exports","tslib","react","reselect","modules/clean/ajax_as_promised","modules/clean/event_handler","modules/clean/react/account_menu/account_menu_view","modules/clean/react/css","modules/core/uri","modules/clean/api_v2/user_client","modules/clean/react/account_menu/account_menu_types","modules/clean/react/account_menu/account_menu_util","modules/clean/web_timing_logger","modules/clean/analytics","modules/clean/snapengage"],(function(e,t,a,n,o,u,c,r,s,l,i,d,m,_,p,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a.__importDefault(n);var g=(function(t){function s(n){var u=t.call(this,n)||this;return u.getUpsellLinks=o.createSelector((function(e){return e.user}),(function(e){return e.viewer}),(function(e,t){var a,n=[];return e.is_team||e.paid?e.is_team||!e.paid||t.role_exists("work")?e.is_team&&t.team_is_limited&&(n=[m.upsellLinks.TRY_BUSINESS]):a=m.upsellLinks.TRY_BUSINESS:a=m.upsellLinks.UPGRADE_PLANS,{quotaBarCTA:a,menuItemUpsells:n}})),u.state={accountPhotoUrl:u.props.accountPhotoUrl||u.props.user.photo_circle_url,isDisabled:!0,accountSpaceUsage:{currentStatus:d.AccountSpaceUsageStatus.NOT_APPLICABLE},experimentExposuresLogged:!1,portkeyChatDiscoverability:"OFF"},u.handleChatLink=function(e){u.widgetId&&(f.DropboxSnapEngage.startSupportChat(u.widgetId),p.TeamsWebActionsLogger.log("chat_discoverability_account_menu_clicked"))},u.handleChangeAvatar=function(){new Promise((function(t,a){e(["modules/clean/account_photo_modal/controller"],t,a)})).then(a.__importStar).then((function(e){return(0,e.AccountPhotoModalController.show)()}))},u.mounted=!1,u}return a.__extends(s,t),s.prototype.componentDidMount=function(){var t=this;this.mounted=!0,this.getQuotaData(),this.events.on(document,"db:account_photo:photo_set",(function(e,a){var n=l.URI.parse(a.saved_photo_url).updateQuery({size:"64x64"}).toString();t.setState({accountPhotoUrl:n})})),this.events.on(document,"db:account_photo:photo_deleted",(function(){t.setState({accountPhotoUrl:null})})),this.setState({isDisabled:!1}),_.waitForTTI().then((function(){new Promise((function(t,a){e(["modules/clean/account/timezone_detection"],t,a)})).then(a.__importStar).then((function(e){e.checkTimezone()})),t.getChatVariants()}))},s.prototype.componentWillUnmount=function(){this.mounted=!1},s.prototype.getQuotaData=function(){return a.__awaiter(this,void 0,void 0,(function(){var e,t,n;return a.__generator(this,(function(a){switch(a.label){case 0:if((e=this.props.user).is_team)return[3,4];this.setState({accountSpaceUsage:{currentStatus:d.AccountSpaceUsageStatus.LOADING}}),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.props.apiV2Client.ns("users").rpc("get_space_usage",void 0,{subjectUserId:e.id})];case 2:return t=a.sent(),this.mounted&&(n=t.allocation,this.setState({accountSpaceUsage:{currentStatus:d.AccountSpaceUsageStatus.READY,used:t.used,allocated:n.allocated}})),[3,4];case 3:return a.sent(),this.mounted&&this.setState({accountSpaceUsage:{currentStatus:d.AccountSpaceUsageStatus.NOT_APPLICABLE}}),[3,4];case 4:return[2]}}))}))},s.prototype.getChatVariants=function(){return a.__awaiter(this,void 0,void 0,(function(){var e,t;return a.__generator(this,(function(a){switch(a.label){case 0:return e=this.props.user,[4,u.SilentBackgroundRequest({url:"/portkey_chat_discoverability_variant",dataType:"json",subject_user:e.id})];case 1:return(t=a.sent())&&(this.widgetId=t.widgetId,this.setState({portkeyChatDiscoverability:t.variant})),[2]}}))}))},s.prototype.render=function(){var e=this.state,t=e.isDisabled,a=e.accountPhotoUrl,o=e.accountSpaceUsage,u=e.portkeyChatDiscoverability,c=this.props,s=c.hideInstallLink,l=c.showSettingsLink,i=c.featuresConfig,d=c.user,m=c.viewer,_=c.onClick,p=this.getUpsellLinks(this.props),f=p.quotaBarCTA,g=p.menuItemUpsells,h="V1"===u&&!!this.widgetId;return n.default.createElement(r.AccountMenuView,{user:d,viewer:m,accountPhotoUrl:a,disabled:t,accountSpaceUsage:o,quotaBarCTA:f,menuItemUpsells:g,showChatLink:h,hideInstallLink:s,showSettingsLink:l,onClickChatLink:this.handleChatLink,onClickChangeAvatar:this.handleChangeAvatar,onClickTrigger:_,featuresConfig:i})},s.defaultProps={accountPhotoUrl:null,hideInstallLink:!1,showSettingsLink:!0,apiV2Client:new i.UserApiV2Client},s=a.__decorate([c.eventHandler],s)})(n.default.Component),h=s.requireCssWithComponent(g,["/static/css/account_menu_common-vflUg8Q_l.css","/static/css/pagelet-vflMzK4D8.css","/static/css/spectrum/index.web-vflTq87Ea.css"]);t.AccountMenu=h})),define("modules/clean/react/account_menu/account_menu_view",["require","exports","tslib","spectrum/account_menu","spectrum/button","spectrum/popover","react","modules/clean/react/account_menu/account_menu_util","modules/core/i18n","modules/clean/react/account_menu/account_menu_types","modules/clean/display_format","modules/clean/react/account_menu/profile_picture","modules/clean/react/growth/features/types","modules/clean/react/growth/logging_util","modules/clean/react/growth/features/util","modules/clean/react/growth/features/badge","modules/clean/analytics","modules/clean/react/retrieval_success_banner/util"],(function(e,t,a,n,o,u,c,r,s,l,i,d,m,_,p,f,g,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),c=a.__importDefault(c);var A=function(){return null},v=function(e){return c.default.createElement(n.AccountMenuItem,a.__assign({target:"_blank",rel:"noopener",tabIndex:0},e))},S=function(e){return c.default.createElement(n.AccountMenuItem,{onClick:h.deleteSearchSuccessBannerSettings,href:r.getLogoutUrl(e.continuation),tabIndex:0},s.intl.formatMessage({id:"3BZJoW",defaultMessage:"Sign out"}))};t.ChatLink=function(e){return c.default.createElement(n.AccountMenuItem,{onClick:e.onClick,tabIndex:0},s.intl.formatMessage({id:"yrxohG",defaultMessage:"Chat with Support"}))};var T=function(){g.GrowthEventsLogger.log("wb_profile_menu_install",{action:"click",location:"in_menu"})},E=function(){return c.default.createElement(v,{onClick:T,href:r.INSTALL_URL},s.intl.formatMessage({id:"/Ww+v3",defaultMessage:"Install"}))};t.OverQuotaIcon=function(e){return c.default.createElement("svg",a.__assign({width:"24px",height:"24px",viewBox:"0 0 24 24"},e),c.default.createElement("g",{stroke:"none",strokeWidth:"1",fillRule:"evenodd"},c.default.createElement("g",{transform:"translate(-224.000000, -32.000000)"},c.default.createElement("g",{transform:"translate(224.000000, 32.000000)"},c.default.createElement("path",{d:"M16.4822397,17.9600934 C18.6953749,17.9600934 19.6038811,16.3972799 18.5180399,14.4810895 L13.960911,6.43909736 C12.8721172,4.51769655 11.1038811,4.52290698 10.0180399,6.43909736 L5.46091101,14.4810895 C4.37211722,16.4024903 5.27664243,17.9600934 7.4967112,17.9600934 L16.4822397,17.9600934 Z M12.9894755,15.9600934 L10.9894755,15.9600934 L10.9894755,13.9600934 L12.9894755,13.9600934 L12.9894755,15.9600934 L12.9894755,15.9600934 Z M12.9894755,12.9600934 L10.9894755,12.9600934 L10.9894755,8.96009345 L12.9894755,8.96009345 L12.9894755,12.9600934 L12.9894755,12.9600934 Z",id:"Shape"})))))},t.QuotaBar=function(e){var a=e.accountSpaceUsage;if(a.currentStatus===l.AccountSpaceUsageStatus.READY){var n=a.used,o=a.allocated,u=y(m.BadgePosition.RIGHT_OF_QUOTA,e.featuresConfig),r=c.default.createElement("div",null,s.intl.formatMessage({id:"2t4ib0",defaultMessage:"{count, plural, one{{used} of {allocated} used} other{{used} of {allocated} used}}"},{count:n,used:i.format_bytes(n),allocated:i.format_bytes(o)}),u);if(n<=o){return c.default.createElement("div",{className:"quota-bar-container"},c.default.createElement("div",{className:"quota-bar-empty"},c.default.createElement("div",{className:"quota-bar-used",style:{width:Math.min(100,n/o*100)+"%"}}),void 0),r,void 0,void 0)}return c.default.createElement("div",{className:"quota-bar-container quota-bar-container--over-quota"},c.default.createElement("div",{className:"quota-bar-empty"},c.default.createElement("div",{className:"quota-bar-used quota-bar-used--over-quota"})),r,c.default.createElement("span",{className:"ax-visually-hidden"},s.intl.formatMessage({id:"PvKSof",defaultMessage:"Exceeded account quota"})),c.default.createElement(t.OverQuotaIcon,null))}return c.default.createElement("div",{className:"quota-bar-container"},c.default.createElement("div",{className:"quota-bar-empty"}),s.intl.formatMessage({id:"9/HmXY",defaultMessage:"Loading quota usage..."}))};var M=function(e){var t=e.quotaBarCTA,a=t.label,n=t.href;return g.GrowthEventsLogger.log("wb_profile_menu_upgrade_link",{action:"view",button_text:a,destination_url:n.split("?")[0],location:"in_menu"}),c.default.createElement("a",{className:"account-menu-upgrade-link",href:n,onClick:function(){g.GrowthEventsLogger.log("wb_profile_menu_upgrade_link",{action:"click",button_text:a,destination_url:n.split("?")[0],location:"in_menu"})}},a)},U=function(e){return c.default.createElement(v,{href:e.href},e.label)},C=function(){return c.default.createElement(n.AccountMenuItem,{href:r.SETTINGS_URL,tabIndex:0},s.intl.formatMessage({id:"x/c7tU",defaultMessage:"Settings"}))},L=function(e){var t=e.photoUrl?s.intl.formatMessage({id:"7VaQw6",defaultMessage:"Change photo"}):s.intl.formatMessage({id:"0UNJMJ",defaultMessage:"Add photo"});return c.default.createElement("button",{className:"account-menu-avatar-link "+(e.className||""),onClick:e.changeAvatarCTA,tabIndex:0},t)},b=function(e){var a,u,r=e.accountSpaceUsage,s=e.quotaBarCTA,i=e.featuresConfig;r&&r.currentStatus!==l.AccountSpaceUsageStatus.NOT_APPLICABLE&&(a=c.default.createElement(t.QuotaBar,{accountSpaceUsage:r,featuresConfig:i})),null==s||i&&i.hideQuotaUpsellLink||(u=c.default.createElement(M,{quotaBarCTA:s}));var f=y(m.BadgePosition.UNDER_ACCOUNT_PHOTO,i),g=(function(e){if(!e||!e.menuItem)return null;var t=e.menuItem,a=e.project,o=t.logDisplayName,u=t.text;if(!u)return null;var r=p.getOnClickHandlerForCta(a,_.ComponentName.AVATAR_MENU,t);if(!r)return null;o&&_.logDisplay(a,_.ComponentName.AVATAR_MENU,{featureType:o});var s=y(m.BadgePosition.RIGHT_OF_MENU_ITEM,e);return c.default.createElement(n.AccountMenuItem,{className:"features-menu-item",onClick:r,onKeyDown:function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e.target.click())},tabIndex:0},u,s)})(i);return c.default.createElement("div",{className:"account-menu-user-summary"},c.default.createElement("div",{className:"account-menu-user-summary__avatar-and-name"},c.default.createElement(o.Button,{variant:"circular",className:"account-menu-user-summary__change-avatar",onClick:e.onClickChangeAvatar},c.default.createElement(d.ProfilePicture,{size:40,src:e.accountPhotoUrl})),c.default.createElement("div",{className:"account-menu-user-summary__display-name-and-link"},e.userDisplayName,c.default.createElement(L,{changeAvatarCTA:e.onClickChangeAvatar,photoUrl:e.accountPhotoUrl}))),f,a,u,g)};function y(e,t){if(!t||!t.badges)return null;var n=t.badges,o=t.project,u=null;switch(e){case m.BadgePosition.RIGHT_OF_MENU_ITEM:u=n.badgeRightOfMenuItem;break;case m.BadgePosition.RIGHT_OF_QUOTA:u=n.badgeRightOfQuota;break;case m.BadgePosition.UNDER_ACCOUNT_PHOTO:u=n.badgeUnderAccountPhoto}return!!u&&c.default.createElement(f.FeaturesBadge,a.__assign({className:"badge--"+e,project:o},u))}var w=(function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleTriggerClick=function(){var e=t.props,a=e.disabled,n=e.onClickTrigger;!a&&n&&(g.GrowthEventsLogger.log("wb_profile_menu",{action:"click",location:"in_menu"}),n())},t}return a.__extends(r,e),r.prototype.render=function(){var e=this.props,a=e.disabled,r=e.accountPhotoUrl,l=e.accountSpaceUsage,i=e.quotaBarCTA,m=e.menuItemUpsells,_=e.showChatLink,p=e.hideInstallLink,f=e.showSettingsLink,g=e.user,h=e.onClickChangeAvatar,v=e.onClickChatLink,T=e.featuresConfig,M=g.display_name;return c.default.createElement(u.Popover,{className:"account-menu",onSelection:A},c.default.createElement(u.PopoverTrigger,{disabled:a,"aria-label":s.intl.formatMessage({id:"YPWjDD",defaultMessage:"Account menu"})},c.default.createElement(o.Button,{tagName:"span",onClick:this.handleTriggerClick,disabled:a,variant:"circular"},c.default.createElement(d.ProfilePicture,{size:32,src:r}))),c.default.createElement(u.PopoverContent,{attachment:"right"},c.default.createElement(n.AccountMenuTitle,null,c.default.createElement(b,{accountPhotoUrl:r,userDisplayName:M,onClickChangeAvatar:h,accountSpaceUsage:l,quotaBarCTA:i,featuresConfig:T})),f&&c.default.createElement(C,null),!p&&c.default.createElement(E,null),m&&m.map(U),_&&c.default.createElement(t.ChatLink,{onClick:v}),c.default.createElement(n.AccountMenuSeparator,null),c.default.createElement(S,null)))},r})(c.default.PureComponent);t.AccountMenuView=w})),define("modules/clean/react/account_menu/account_menu_types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),(function(e){e[e.LOADING=1]="LOADING",e[e.READY=2]="READY",e[e.NOT_APPLICABLE=3]="NOT_APPLICABLE"})(t.AccountSpaceUsageStatus||(t.AccountSpaceUsageStatus={})),(function(e){e.SETTINGS="settings",e.INSTALL="install",e.CHAT="chat",e.LOGOUT="logout"})(t.AccountMenuSelectionOption||(t.AccountMenuSelectionOption={})),(function(e){e[e.ALWAYS=0]="ALWAYS",e[e.STANDARD=50]="STANDARD",e[e.ALMOST_FULL=80]="ALMOST_FULL",e[e.OVERQUOTA=100]="OVERQUOTA"})(t.AccountMenuQuotaBarBreakpoints||(t.AccountMenuQuotaBarBreakpoints={})),(function(e){e.UPGRADE="UPGRADE",e.GET_MORE_SPACE="GET_MORE_SPACE"})(t.UpgradeText||(t.UpgradeText={}))})),define("modules/clean/react/account_menu/account_menu_util",["require","exports","tslib","modules/clean/analytics","modules/clean/react/account_menu/account_menu_types","modules/constants/trademark","modules/core/browser","modules/core/i18n","modules/core/uri"],(function(e,t,a,n,o,u,c,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),c=a.__importStar(c),t.getLogoutUrl=function(e){return new s.URI({scheme:"https",authority:"www.dropbox.com",path:"/logout",query:e?{cont:e}:void 0}).toString()},t.INSTALL_URL=new s.URI({scheme:"https",authority:"www.dropbox.com",path:"/install"}).toString(),t.SETTINGS_URL=new s.URI({scheme:"https",authority:"www.dropbox.com",path:"/account"}).toString(),t.UPGRADE_URL=new s.URI({scheme:"https",authority:"www.dropbox.com",path:"/plans",query:{trigger:"direct"}}).toString(),t.getAccountSpaceUsage=function(e,t){return t.serialized_sku_content.has_unlimited_space?{currentStatus:o.AccountSpaceUsageStatus.NOT_APPLICABLE}:"other"===e.allocation[".tag"]?{currentStatus:o.AccountSpaceUsageStatus.NOT_APPLICABLE}:{currentStatus:o.AccountSpaceUsageStatus.READY,used:e.used,allocated:e.allocation.allocated}},t.upsellLinks={UPGRADE_PLANS:{label:r.intl.formatMessage({id:"pvR+AO",defaultMessage:"Upgrade"}),href:t.UPGRADE_URL},TRY_BUSINESS:{label:r.intl.formatMessage({id:"KVRyHc",defaultMessage:"Try {trademark_business}"},{trademark_business:u.TRADEMARK_BUSINESS}),href:new s.URI({scheme:"https",authority:"www.dropbox.com",path:"/business/try",query:{_tk:"dropdown"}}).toString()}},t.handleChangeAvatar=function(){return a.__awaiter(void 0,void 0,void 0,(function(){return a.__generator(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t,a){e(["modules/clean/account_photo_modal/controller"],t,a)})).then(a.__importStar)];case 1:return t.sent().AccountPhotoModalController.show(),[2]}}))}))},t.handleMenuToggle=function(e){e.isOpen&&n.GrowthEventsLogger.log("wb_profile_menu",{action:"click",location:"in_menu",version:"v2"})},t.handleInstallClick=function(){n.GrowthEventsLogger.log("wb_profile_menu_install",{action:"click",location:"in_menu",version:"v2"})},t.getUpgradeButtonText=function(e){return e===o.UpgradeText.UPGRADE?r.intl.formatMessage({id:"pvR+AO",defaultMessage:"Upgrade"}):r.intl.formatMessage({id:"iIucBq",defaultMessage:"Get more space"})},t.getUpsellText=function(e,t){var a=void 0;return t>=o.AccountMenuQuotaBarBreakpoints.OVERQUOTA?a=e===o.UpgradeText.UPGRADE?r.intl.formatMessage({id:"yyD/RX",defaultMessage:"Free up space or upgrade now"}):r.intl.formatMessage({id:"n1FlQX",defaultMessage:"Your account is out of storage"}):t>=o.AccountMenuQuotaBarBreakpoints.ALMOST_FULL&&(a=e===o.UpgradeText.UPGRADE?r.intl.formatMessage({id:"aj6XpI",defaultMessage:"Upgrade soon to get more space"}):r.intl.formatMessage({id:"KCKRu4",defaultMessage:"Youâ€™re almost out of storage"})),a},t.handleUpgradeButtonView=function(e){n.GrowthEventsLogger.log("wb_profile_menu_upgrade_link",{action:"view",button_text:e,destination_url:t.UPGRADE_URL,location:"in_menu",version:"v2"})},t.handleUpgradeButtonClick=function(e){n.GrowthEventsLogger.log("wb_profile_menu_upgrade_link",{action:"click",button_text:e,location:"in_menu",version:"v2"}),c.redirect(t.UPGRADE_URL)}})),define("modules/clean/react/account_menu/profile_picture",["require","exports","tslib","react","modules/core/i18n","modules/clean/static_urls"],(function(e,t,a,n,o,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a.__importDefault(n);var c=u.static_url("/static/images/avatar/faceholder-vflmhyJKO.svg");t.ProfilePicture=function(e){return n.default.createElement("img",{className:"mc-avatar-image",style:{height:e.size,width:e.size},src:e.src||c,alt:o.intl.formatMessage({id:"+SWqX/",defaultMessage:"Account photo"})})}}));
//# sourceMappingURL=pkg-account_menu.min.js-vfl7GoZ4k.map